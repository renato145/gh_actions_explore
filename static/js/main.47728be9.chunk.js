(this.webpackJsonpperu_news=this.webpackJsonpperu_news||[]).push([[0],{205:function(e,t,n){},206:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(2),c=n.n(r),i=n(71),s=n.n(i),o=n(208),l=n(73),u=n(72),d=n(9),f=n.n(d),j=n(21),b=n(22),v=n.n(b),m=n(211),O=function(){var e=Object(j.a)(f.a.mark((function e(){var t,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("https://api.github.com/repos/renato145/peru_news/contents/data/summary?ref=main",{});case 2:if(t=e.sent,n=t.data,200===(a=t.status)){e.next=7;break}throw new Error("status: ".concat(a));case 7:return e.abrupt("return",n.map((function(e){return{download_url:e.download_url,name:e.name.split(".json")[0]}})).sort((function(e,t){return t.name.localeCompare(e.name)})));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=n(17),x=n(210),h=function(){var e=Object(j.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching summary data from ".concat(t)),e.next=3,v.a.get(t);case 3:if(n=e.sent,a=n.data,200===(r=n.status)){e.next=8;break}throw new Error("status: ".concat(r));case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=n(8),w=n(74),D=function(e,t,n,a){var r=new Map;return t.forEach((function(t){var n=e[t];void 0!==n&&Object.entries(n).forEach((function(e){var t,n=Object(g.a)(e,2),c=n[0],i=n[1],s=null!==(t=r.get(c))&&void 0!==t?t:new Map;Object.entries(i).forEach((function(e){var t,n=Object(g.a)(e,2),r=n[0],c=n[1];-1===a.indexOf(r)&&s.set(r,(null!==(t=s.get(r))&&void 0!==t?t:0)+c)})),r.set(c,s)}))})),Array.from(r).map((function(e){var t=Object(g.a)(e,2),a=t[0],r=t[1];return[a,Array.from(r).sort((function(e,t){return t[1]-e[1]})).slice(0,n)]}))},N=function(e,t,n){var a=new Map;return""!==t&&Object.entries(e).filter((function(e){var t=Object(g.a)(e,1)[0];return n.indexOf(t)>-1})).forEach((function(e){var n=Object(g.a)(e,2),r=n[0],c=n[1];Object.entries(c).forEach((function(e){var n,c,i=Object(g.a)(e,2),s=i[0],o=i[1];a.has(s)||a.set(s,[]),null===(n=a.get(s))||void 0===n||n.push([r,null!==(c=o[t])&&void 0!==c?c:0])}))})),a},y=Object(w.a)((function(e,t){var n,a;return{data:{},topk:0,activeDates:[],activeData:[],selectedWord:"",wordData:null,filters:null!==(n=null===(a=localStorage.getItem("filters"))||void 0===a?void 0:a.split(","))&&void 0!==n?n:[],add:function(t){e((function(e){var n=e.data;return{data:Object.assign(n,t)}}))},addActiveDate:function(t){e((function(e){var n=e.data,a=e.activeDates,r=e.topk,c=e.filters,i=e.selectedWord;if(a.indexOf(t)>-1)return{};var s=a.concat(t);return 0===r?{activeDates:s}:{activeDates:s,activeData:D(n,s,r,c),wordData:N(n,i,s)}}))},rmActiveDate:function(t){e((function(e){var n=e.data,a=e.activeDates,r=e.topk,c=e.filters,i=e.selectedWord;if(a.indexOf(t)>-1){var s=a.filter((function(e){return e!==t}));return 0===r?{activeDates:s}:{activeDates:s,activeData:D(n,s,r,c),wordData:N(n,i,s)}}return{}}))},isActiveDate:function(e){return t().activeDates.indexOf(e)>-1},setSelectedWord:function(t){e((function(e){var n=e.data,a=e.activeDates,r=N(n,t,a);return{selectedWord:t,wordData:r}}))},setTopK:function(t){e((function(){return{topk:t}}))},addFilter:function(t){e((function(e){var n=e.data,a=e.activeDates,r=e.topk,c=e.filters;if(c.indexOf(t)>-1)return{};var i=c.concat(t);return localStorage.setItem("filters",i.join()),{activeData:D(n,a,r,i),filters:i}}))},rmFilter:function(t){e((function(e){var n=e.data,a=e.activeDates,r=e.topk,c=e.filters;if(c.indexOf(t)>-1){var i=c.filter((function(e){return e!==t}));return localStorage.setItem("filters",i.join()),{activeData:D(n,a,r,i),filters:i}}return{}}))},getTimelineData:function(e){var n;return null===(n=t().wordData)||void 0===n?void 0:n.get(e)}}})),k=n(209),S=function(e){return Object(k.a)(e,"yyyyMMdd",new Date)},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dd/MM/Y";return Object(x.a)(e,t)},C=function(e){return Object(x.a)(S(e),"dd/MM/Y")},F=function(e){var t=e.date,n=e.url,c=e.load,i=e.className,s=void 0===i?"":i,o=function(e){return Object(m.a)(["data",{url:e}],(function(){return h(e)}),{enabled:!1,retry:!1})}(n),l=o.isError,u=o.isLoading,d=o.isSuccess,f=o.refetch,j=y(function(e){return function(t){return{add:t.add,addDate:function(){return t.addActiveDate(e)},removeDate:function(){return t.rmActiveDate(e)},isActive:t.isActiveDate(e)}}}(t)),b=j.add,v=j.addDate,O=j.removeDate,x=j.isActive,g=Object(r.useCallback)((function(){x||l?O():d&&v()}),[x,l,O,d,v]),w=Object(r.useCallback)((function(){if(d)g();else{if(u)return;f().then((function(e){var n=e.data;n&&(b(Object(p.a)({},t,n)),v())}))}}),[b,v,u,d,f,g,t]);return Object(r.useEffect)((function(){c&&w()}),[c]),l?null:Object(a.jsx)("div",{className:"".concat(s," p-2 transition cursor-pointer ").concat(x?"bg-green-600 text-gray-50":"bg-gray-300"," ").concat(u?"animate-pulse":""),onClick:w,children:Object(a.jsx)("p",{className:"font-semibold pointer-events-none",children:C(t)})})},E=function(e){var t=e.className,n=null!==t&&void 0!==t?t:"h-5 w-5";return Object(a.jsxs)("svg",{className:"animate-spin mr-3 ".concat(n),fill:"none",viewBox:"0 0 24 24",children:[Object(a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Object(a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},W=function(e){var t=e.n,n=e.loadN,r=Object(m.a)("files",(function(){return O()})),c=r.data,i=r.error,s=r.status;return Object(a.jsx)("div",{className:"-mt-2 -ml-2 flex flex-wrap",children:"error"===s?Object(a.jsxs)("p",{children:["Couldn't load files: ",Object(a.jsx)("span",{children:String(i)})]}):"success"===s&&c?c.slice(0,t).map((function(e,t){var r=e.download_url,c=e.name;return Object(a.jsx)(F,{className:"mt-2 ml-2",date:c,url:r,load:t<n},t)})):Object(a.jsx)("div",{className:"w-full flex justify-center",children:Object(a.jsx)(E,{className:"h-10 w-10"})})})},A=function(){var e=Object(j.a)(f.a.mark((function e(){var t,n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("https://raw.githubusercontent.com/renato145/peru_news/main/settings.json",{});case 2:if(t=e.sent,n=t.data,200===(a=t.status)){e.next=7;break}throw new Error("status: ".concat(a));case 7:return r=new Map,n.sources.forEach((function(e){var t=e.name,n=e.url;return r.set(t,n)})),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=n(25),T=n(36),I=function(e){return{rmFilter:e.rmFilter}},L=function(e){var t=e.word,n=e.className,r=void 0===n?"":n,c=Object(T.a)(e,["word","className"]),i=y(I).rmFilter;return Object(a.jsx)("div",Object(_.a)(Object(_.a)({className:"px-2 rounded-md bg-red-400 hover:bg-red-600 text-sm text-white font-medium transition-colors cursor-pointer ".concat(r),onClick:function(){i(t)}},c),{},{children:t}))},z=n(77),K=n(75),B=n(16),P=20,J=10,R=10,Y=10,q=function(e){var t=e.data,n=e.xScale,c=Object(K.a)({polyfill:z.a}),i=Object(g.a)(c,2),s=i[0],o=i[1].width,l=o/3,u=Object(r.useMemo)((function(){var e,a=[0,null!==(e=Object(B.d)(t.map((function(e){return e[1]}))))&&void 0!==e?e:0],r=Object(B.e)().domain(a).range([l-Y,R]),c=n.range([P+3,o-J]),i=t.map((function(e){var t=Object(g.a)(e,2),n=t[0],a=t[1];return[c(S(n)),r(a)]})),s=Object(B.c)()(i),u=Object(B.a)(r).ticks(2).tickFormat((function(e){return+e%1===0?""+e:""})).tickSize(-o+P-J).tickSizeOuter(0);return{values:i,path:s,timeScale:c,yScale:r,axisLeft:u}}),[n,o,l,t]),d=u.values,f=u.path,j=u.timeScale,b=u.yScale,v=u.axisLeft,m=Object(r.useCallback)((function(e){Object(B.g)(e).call(v)}),[v]);return Object(a.jsx)("svg",{ref:s,className:"w-full my-1 bg-white rounded",height:o/3,children:f&&d?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("g",{ref:m,transform:"translate(".concat(P,",0)"),className:"leftAxis"}),Object(a.jsx)("path",{fill:"none",className:"stroke-current text-blue-700 stroke-2 transition-all",d:f}),d.map((function(e,t){var n=Object(g.a)(e,2),r=n[0],c=n[1];return Object(a.jsx)("circle",{cx:r,cy:c,className:"scatter hover:scatter-lg fill-current text-blue-700 hover:text-blue-400 transition-all",children:Object(a.jsx)("title",{children:"".concat(Math.round(b.invert(c))," (").concat(M(j.invert(r),"dd MMM"),")")})},t)}))]}):null})},H=function(e){return{selectedWord:e.selectedWord,setSelectedWord:e.setSelectedWord,addFilter:e.addFilter}},Q=function(e){var t=e.data,n=y(H),c=n.selectedWord,i=n.setSelectedWord,s=n.addFilter,o=Object(r.useMemo)((function(){return 0===t.length?0:t.map((function(e){var t=Object(g.a)(e,2);t[0];return t[1]})).reduce((function(e,t){return Math.max(e,t)}))}),[t]);return Object(a.jsx)("div",{className:"flex flex-col space-y-1",children:t.map((function(e,t){var n=Object(g.a)(e,2),r=n[0],l=n[1];return Object(a.jsxs)("div",{className:"group relative flex items-center h-8",onClick:function(){return function(e){i(c!==e?e:"")}(r)},children:[Object(a.jsxs)("div",{className:"absolute flex w-full justify-between pl-2",children:[Object(a.jsxs)("p",{className:"pointer-events-none ".concat(c===r?"font-semibold":""),children:[r," (",l,")"]}),Object(a.jsx)("p",{className:"mr-2 font-bold text-xs cursor-pointer text-gray-400 hover:text-gray-900",onClick:function(e){return function(e,t){e.stopPropagation(),c===t&&i(""),s(t)}(e,r)},children:"X"})]}),Object(a.jsx)("div",{className:"h-full transition-all duration-300 cursor-pointer group-hover:bg-blue-300 ".concat(c===r?"bg-blue-400":"bg-blue-200"),style:{width:"".concat(100*l/o,"%")}})]},t)}))})},V=function(e){return e.wordData},X=function(e){var t=e.name2url,n=e.name,r=e.wc,c=e.xScale,i=Object(T.a)(e,["name2url","name","wc","xScale"]),s=y(V),o=null===s||void 0===s?void 0:s.get(n);return Object(a.jsxs)("div",Object(_.a)(Object(_.a)({},i),{},{children:[o&&null!==c?Object(a.jsx)(q,{data:o,xScale:c}):null,Object(a.jsx)("a",{className:"capitalize text-lg font-semibold",href:null===t||void 0===t?void 0:t.get(n),target:"_black",rel:"noopener",children:n.replace("_"," ")}),Object(a.jsx)("div",{className:"my-2",children:Object(a.jsx)(Q,{data:r})})]}))},G=function(e){return{activeData:e.activeData,activeDates:e.activeDates,setTopK:e.setTopK,filters:e.filters}},U=function(e){var t=e.topk,n=y(G),c=n.activeData,i=n.activeDates,s=n.setTopK,o=n.filters,l=Object(m.a)("name2url",(function(){return A()})).data,u=Object(r.useMemo)((function(){var e=Object(B.b)(i.map(S));return e[0]?Object(B.f)().domain(e):null}),[i]);return Object(r.useEffect)((function(){s(t)}),[s,t]),Object(a.jsx)("div",{className:"mt-2",children:0===c.length?Object(a.jsx)("div",{className:"mt-10 flex justify-center",children:Object(a.jsx)(E,{className:"h-14 w-14"})}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("p",{className:"font-semibold",children:["Loaded data: ",i.length]}),Object(a.jsx)("div",{className:"flex flex-wrap -ml-1",children:o.map((function(e,t){return Object(a.jsx)(L,{className:"ml-1 mt-0.5",word:e},t)}))}),Object(a.jsx)("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:c.sort((function(e,t){var n=Object(g.a)(e,1)[0],a=Object(g.a)(t,1)[0];return n.localeCompare(a)})).map((function(e,t){var n=Object(g.a)(e,2),r=n[0],c=n[1];return Object(a.jsx)(X,{className:"px-4 py-2 bg-blue-50",name2url:l,name:r,wc:c,xScale:u},t)}))})]})})},Z=new o.a({defaultOptions:{queries:{refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1,cacheTime:36e5}}}),$=function(){return Object(a.jsxs)(l.a,{client:Z,children:[Object(a.jsxs)("div",{className:"m-4",children:[Object(a.jsx)(W,{n:10,loadN:5}),Object(a.jsx)(U,{topk:10})]}),Object(a.jsx)(u.ReactQueryDevtools,{initialIsOpen:!0})]})},ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,212)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};n(205);s.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)($,{})}),document.getElementById("root")),ee()}},[[206,1,2]]]);
//# sourceMappingURL=main.47728be9.chunk.js.map